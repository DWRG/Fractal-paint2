var l=!1;function n(a,b,c,d,e,k,g,f){var j=0>(a-g)*(k-f)-(e-g)*(b-f);return 0>(a-e)*(d-k)-(c-e)*(b-k)==j&&j==0>(a-c)*(f-d)-(g-c)*(b-d)}window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;function q(a,b,c){this.width=a.width;this.height=a.height;this.canvas=a;this.b=a.getContext("2d");this.r=b;this.a=c;b.style.display="none";this.e=document.createElement("canvas");this.e.width=this.width;this.e.height=this.height;this.j=this.e.getContext("2d")} q.prototype={reset:function(){this.b.clearRect(0,0,this.width,this.height);this.b.drawImage(this.r,0,0)},step:function(){var a=this.j,b=this.a[0],c,d=1/(b[0]*b[3]-b[1]*b[2]),e,k,g,f,j;a.clearRect(0,0,this.width,this.height);a.drawImage(this.r,0,0);a.save();for(var h=1;h<this.a.length;h++)c=this.a[h],e=(b[3]*c[0]-b[2]*c[1])*d,k=(b[0]*c[1]-b[1]*c[0])*d,g=(b[3]*c[2]-b[2]*c[3])*d,f=(b[0]*c[3]-b[1]*c[2])*d,j=c[4]-b[4]*e-b[5]*k,c=c[5]-b[4]*g-b[5]*f,a.setTransform(e,g,k,f,j,c),a.drawImage(this.canvas,0, 0);a.restore();a=this.canvas;this.canvas=this.e;this.e=a;a=this.b;this.b=this.j;this.j=a}};function r(a){this.width=a.width;this.height=a.height;this.canvas=a;this.b=a.getContext("2d");this.f=this.d=l} r.prototype={m:function(a){var b=this.b;b.lineCap="round";b.strokeStyle="white";0==a.button?(b.globalCompositeOperation="source-over",this.d=!0,this.f=l):2==a.button&&(b.globalCompositeOperation="destination-out",this.d=l,this.f=!0);this.g=a.layerX;this.h=a.layerY},n:function(a){if(this.d||this.f){var b=this.b,c=a.layerX;a=a.layerY;var d=(c-this.g)*(c-this.g)+(a-this.h)*(a-this.h);b.lineWidth=this.d?Math.min(6,Math.pow(d,0.25)):Math.min(30,6+Math.pow(d,0.25));b.beginPath();b.moveTo(this.g,this.h); b.lineTo(c,a);b.stroke();this.g=c;this.h=a}},o:function(){this.f=this.d=l},transform:function(a,b,c,d,e,k){var g=this.b;g.save();g.setTransform(a,c,b,d,e,k);g.globalCompositeOperation="destination-atop";g.drawImage(this.canvas,0,0);g.restore()}};function s(a,b,c,d){this.width=a.width;this.height=a.height;this.canvas=a;this.b=a.getContext("2d");this.a=b;this.selection={index:-1,c:-1};this.k=l;this.t=c;this.l=l;this.i=d;var e=this;e.canvas.onmousedown=function(){e.m.apply(e,arguments)};e.canvas.onmouseup=function(){e.o.apply(e,arguments)};e.canvas.onmousemove=function(){e.n.apply(e,arguments)};e.canvas.onmouseover=function(){e.v.apply(e,arguments)};e.canvas.onmouseout=function(){e.u.apply(e,arguments)};e.canvas.ondblclick=function(){e.s.apply(e, arguments)};if("onwheel"in e.canvas)m="onwheel";else if("onmousewheel"in e.canvas)m="onmousewheel";else throw Error("Mousewheel event not supported.");e.canvas[m]=function(){e.wheel.apply(e,arguments)}} s.prototype={select:function(a){var b,c;this.selection={index:-1,c:-1};for(var d=this.a.length-1;0<=d;d--)b=this.a[d],c=(b[4]-a.layerX)*(b[4]-a.layerX)+(b[5]-a.layerY)*(b[5]-a.layerY),64>c&&(this.selection.index=d,this.selection.c=0),c=(b[4]+b[0]-a.layerX)*(b[4]+b[0]-a.layerX)+(b[5]+b[2]-a.layerY)*(b[5]+b[2]-a.layerY),64>c&&(this.selection.index=d,this.selection.c=1),c=(b[4]+b[0]+b[1]-a.layerX)*(b[4]+b[0]+b[1]-a.layerX)+(b[5]+b[2]+b[3]-a.layerY)*(b[5]+b[2]+b[3]-a.layerY),64>c&&(this.selection.index= d,this.selection.c=2),c=(b[4]+b[1]-a.layerX)*(b[4]+b[1]-a.layerX)+(b[5]+b[3]-a.layerY)*(b[5]+b[3]-a.layerY),64>c&&(this.selection.index=d,this.selection.c=3);if(-1==this.selection.index)for(d=this.a.length-1;0<=d;d--)if(b=this.a[d],t(a.layerX,a.layerY,b)){this.selection.index=d;break}this.k=!0},m:function(a){a.shiftKey?(this.select(a),this.p=a.layerX,this.q=a.layerY):this.i.m(a)},o:function(a){this.i.o(a);this.selection.index=-1;this.k=l},n:function(a){if(a.shiftKey)if(-1==this.selection.index){if(this.k){var b= a.layerX-this.p,c=a.layerY-this.q;this.i.transform(1,0,0,1,b,c);this.a.forEach(function(a){a2=a[0];b2=a[1];e2=a[4];c2=a[2];d2=a[3];f2=a[5];a[0]=1*a2+0*c2;a[1]=1*b2+0*d2;a[2]=0*a2+1*c2;a[3]=0*b2+1*d2;a[4]=b+1*e2+0*f2;a[5]=c+0*e2+1*f2})}}else{var d=this.a[this.selection.index],e,k,g,f,j,h,p;switch(this.selection.c){case -1:d[4]+=a.layerX-this.p;d[5]+=a.layerY-this.q;break;case 0:e=a.layerX;k=a.layerY;j=d[4]+d[0]+d[1];h=d[5]+d[2]+d[3];g=(e+j+h-k)/2;f=(k+h+e-j)/2;break;case 1:g=a.layerX;f=a.layerY;h= d[4]+d[1];p=d[5]+d[3];e=(g+h-p+f)/2;k=(f+p-g+h)/2;j=(g+h+p-f)/2;h=(f+p+g-h)/2;break;case 2:j=a.layerX;h=a.layerY;e=d[4];k=d[5];g=(e+j+h-k)/2;f=(k+h+e-j)/2;break;case 3:h=a.layerX,p=a.layerY,g=d[4]+d[0],f=d[5]+d[2],e=(g+h-p+f)/2,k=(f+p-g+h)/2,j=(g+h+p-f)/2,h=(f+p+g-h)/2}-1!=this.selection.c&&(d[0]=g-e,d[2]=f-k,d[1]=j-g,d[3]=h-f,d[4]=e,d[5]=k);this.t.reset()}else this.i.n(a);this.p=a.layerX;this.q=a.layerY},v:function(){this.l=!0},u:function(){this.l=l},s:function(a){var b=this.a,c,d,e;for(d=b.length- 1;1<=d;d--)if(c=b[d],t(a.layerX,a.layerY,c)){b.splice(d,1);return}c=b[0];d=(0.45+0.2*Math.random())*Math.sqrt(c[0]*c[0]+c[1]*c[1]);e=Math.random()*Math.PI;c=d*Math.cos(e);d*=Math.sin(e);c=[c,d,-d,c,a.layerX-(c+d)/2,a.layerY-(c-d)/2];b.push(c)},step:function(){var a=this.b,b,c,d,e;a.clearRect(0,0,this.width,this.height);if(this.l)for(var k=0;2>k;k++){0==k?(a.strokeStyle="black",a.lineWidth=4):(a.strokeStyle="yellow",a.lineWidth=2);for(var g=0;g<this.a.length;g++){1==k&&1==g&&(a.strokeStyle="white"); b=this.a[g];a.beginPath();a.moveTo(b[4],b[5]);a.lineTo(b[4]+b[0],b[5]+b[2]);a.lineTo(b[4]+b[0]+b[1],b[5]+b[2]+b[3]);a.lineTo(b[4]+b[1],b[5]+b[3]);a.closePath();a.stroke();for(var f=0;2>f;f++)c=b[4]+b[0+f]/2,d=b[5]+b[2+f]/2,e=Math.sqrt(b[0+f]*b[0+f]+b[2+f]*b[2+f]),e=10<e?5/e:0.5,a.beginPath(),a.moveTo(c-(b[0+f]-b[2+f])*e,d-(b[2+f]+b[0+f])*e),a.lineTo(c,d),a.lineTo(c-(b[0+f]+b[2+f])*e,d-(b[2+f]-b[0+f])*e),a.stroke()}}}}; function t(a,b,c){return n(a,b,c[4],c[5],c[4]+c[0],c[5]+c[2],c[4]+c[1],c[5]+c[3])||n(a,b,c[4]+c[0]+c[1],c[5]+c[2]+c[3],c[4]+c[0],c[5]+c[2],c[4]+c[1],c[5]+c[3])};function u(){v.step();w.step();requestAnimationFrame(u)}var x=document.querySelector("#fractal"),y=document.querySelector("#controls"),z=document.querySelector("#draw-target"),A=document.querySelector("#wrapper"),B=document.querySelector("#bg");x.width=y.width=z.width=A.offsetWidth;B.style.width=A.offsetWidth+"px";x.height=y.height=z.height=A.offsetHeight;B.style.height=A.offsetHeight+"px";y.addEventListener("contextmenu",function(a){a.preventDefault()},l); var C=[],D=z.width,E=z.height,F=Math.min(D/3,E/3),G,H,I,J,K;C.length=0;C.push([F,0,0,F,(D-F)/2,(E-F)/2]);for(var F=0.6*F,L=0;3>L;L++)G=2*Math.random()*Math.PI,H=F*Math.cos(G),I=-F*Math.sin(G),J=0.5<Math.random()?D*(1+Math.random())/5:D*(4-Math.random())/5,K=0.5<Math.random()?E*(1+Math.random())/5:E*(4-Math.random())/5,C.push([H,I,-I,H,J-H-I,K+I-H]),F*=0.8-0.1*Math.random();var v=new q(x,z,C),N=new r(z),w=new s(y,C,v,N);v.reset();u(); document.querySelector("#info a").onclick=function(){this.parentNode.style.display="none"};document.onclick=function(){document.body.className=""};document.z=function(){document.className="hover";return l};document.w=function(){document.className="";return l}; document.A=function(a){document.className="";a.preventDefault();a=a.dataTransfer.files[0];var b=new FileReader;b.onload=function(a){if("data:image/"==a.target.result.substr(0,11)){var b=new Image;b.onload=function(){var a=N.b,c,g,f,j;a.globalCompositeOperation="source-over";a.clearRect(0,0,N.width,N.height);b.width>N.width||b.height>N.height?N.height*b.width>b.height*N.width?(f=N.width,j=b.height*N.width/b.width,c=0,g=(N.height-j)/2):(f=b.width*N.height/b.height,j=N.height,c=(N.width-f)/2,g=0):(f= b.width,j=b.height,c=(N.width-b.width)/2,g=(N.height-b.height)/2);a.drawImage(b,c,g,f,j);f=a.getImageData(c,g,f,j);j=f.data;for(var h=0,p=j.length;h<p;h+=4){var M=j[h+3];j[h+3]=0|Math.max(j[h],j[h+1],j[h+2])*M/255;j[h]=j[h+1]=j[h+2]=255}a.putImageData(f,c,g)};b.src=a.target.result}};b.readAsDataURL(a);return l};