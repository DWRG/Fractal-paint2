var k=!1;function m(b,a,c,e,d,j,g,f){var h=0>(b-g)*(j-f)-(d-g)*(a-f);return 0>(b-d)*(e-j)-(c-d)*(a-j)==h&&h==0>(b-c)*(f-e)-(g-c)*(a-e)}window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;function n(b,a,c){this.width=b.width;this.height=b.height;this.canvas=b;this.b=b.getContext("2d");this.r=a;this.a=c;a.style.display="none";this.e=document.createElement("canvas");this.e.width=this.width;this.e.height=this.height;this.l=this.e.getContext("2d")} n.prototype={reset:function(){this.b.clearRect(0,0,this.width,this.height);this.b.drawImage(this.r,0,0)},step:function(){var b=this.l,a=this.a[0],c,e=1/(a[0]*a[3]-a[1]*a[2]),d,j,g,f,h;b.clearRect(0,0,this.width,this.height);b.drawImage(this.r,0,0);b.save();for(var l=1;l<this.a.length;l++)c=this.a[l],d=(a[3]*c[0]-a[2]*c[1])*e,j=(a[0]*c[1]-a[1]*c[0])*e,g=(a[3]*c[2]-a[2]*c[3])*e,f=(a[0]*c[3]-a[1]*c[2])*e,h=c[4]-a[4]*d-a[5]*j,c=c[5]-a[4]*g-a[5]*f,b.setTransform(d,g,j,f,h,c),b.drawImage(this.canvas,0, 0);b.restore();b=this.canvas;this.canvas=this.e;this.e=b;b=this.b;this.b=this.l;this.l=b}};function p(b){this.width=b.width;this.height=b.height;this.canvas=b;this.b=b.getContext("2d");this.f=this.d=k} p.prototype={o:function(b){var a=this.b;a.lineCap="round";a.strokeStyle="white";0==b.button?(a.globalCompositeOperation="source-over",this.d=!0,this.f=k):2==b.button&&(a.globalCompositeOperation="destination-out",this.d=k,this.f=!0);this.g=b.layerX;this.h=b.layerY},p:function(b){if(this.d||this.f){var a=this.b,c=b.layerX;b=b.layerY;var e=(c-this.g)*(c-this.g)+(b-this.h)*(b-this.h);a.lineWidth=this.d?Math.min(6,Math.pow(e,0.25)):Math.min(30,6+Math.pow(e,0.25));a.beginPath();a.moveTo(this.g,this.h); a.lineTo(c,b);a.stroke();this.g=c;this.h=b}},q:function(){this.f=this.d=k},transform:function(b,a,c,e,d,j){var g=this.b;g.save();g.setTransform(b,c,a,e,d,j);g.globalCompositeOperation="destination-atop";g.drawImage(this.canvas,0,0);g.restore()}};function q(b,a,c,e){this.width=b.width;this.height=b.height;this.canvas=b;this.b=b.getContext("2d");this.a=a;this.selection={index:-1,c:-1};this.m=k;this.t=c;this.n=k;this.i=e;var d=this;d.canvas.onmousedown=function(){d.o.apply(d,arguments)};d.canvas.onmouseup=function(){d.q.apply(d,arguments)};d.canvas.onmousemove=function(){d.p.apply(d,arguments)};d.canvas.onmouseover=function(){d.v.apply(d,arguments)};d.canvas.onmouseout=function(){d.u.apply(d,arguments)};d.canvas.ondblclick=function(){d.s.apply(d, arguments)};d.canvas.onmousewheel=d.canvas.onwheel=function(){d.w.apply(d,arguments)}} q.prototype={select:function(b){var a,c;this.selection={index:-1,c:-1};for(var e=this.a.length-1;0<=e;e--)a=this.a[e],c=(a[4]-b.layerX)*(a[4]-b.layerX)+(a[5]-b.layerY)*(a[5]-b.layerY),64>c&&(this.selection.index=e,this.selection.c=0),c=(a[4]+a[0]-b.layerX)*(a[4]+a[0]-b.layerX)+(a[5]+a[2]-b.layerY)*(a[5]+a[2]-b.layerY),64>c&&(this.selection.index=e,this.selection.c=1),c=(a[4]+a[0]+a[1]-b.layerX)*(a[4]+a[0]+a[1]-b.layerX)+(a[5]+a[2]+a[3]-b.layerY)*(a[5]+a[2]+a[3]-b.layerY),64>c&&(this.selection.index= e,this.selection.c=2),c=(a[4]+a[1]-b.layerX)*(a[4]+a[1]-b.layerX)+(a[5]+a[3]-b.layerY)*(a[5]+a[3]-b.layerY),64>c&&(this.selection.index=e,this.selection.c=3);if(-1==this.selection.index)for(e=this.a.length-1;0<=e;e--)if(a=this.a[e],r(b.layerX,b.layerY,a)){this.selection.index=e;break}this.m=!0},o:function(b){b.shiftKey?(this.select(b),this.j=b.layerX,this.k=b.layerY):this.i.o(b)},q:function(b){this.i.q(b);this.selection.index=-1;this.m=k},p:function(b){if(b.shiftKey)if(-1==this.selection.index)this.m&& s(this,1,1,b.layerX-this.j,b.layerY-this.k);else{var a=this.a[this.selection.index],c,e,d,j,g,f,h;switch(this.selection.c){case -1:a[4]+=b.layerX-this.j;a[5]+=b.layerY-this.k;break;case 0:c=b.layerX;e=b.layerY;g=a[4]+a[0]+a[1];f=a[5]+a[2]+a[3];d=(c+g+f-e)/2;j=(e+f+c-g)/2;break;case 1:d=b.layerX;j=b.layerY;f=a[4]+a[1];h=a[5]+a[3];c=(d+f-h+j)/2;e=(j+h-d+f)/2;g=(d+f+h-j)/2;f=(j+h+d-f)/2;break;case 2:g=b.layerX;f=b.layerY;c=a[4];e=a[5];d=(c+g+f-e)/2;j=(e+f+c-g)/2;break;case 3:f=b.layerX,h=b.layerY,d= a[4]+a[0],j=a[5]+a[2],c=(d+f-h+j)/2,e=(j+h-d+f)/2,g=(d+f+h-j)/2,f=(j+h+d-f)/2}-1!=this.selection.c&&(a[0]=d-c,a[2]=j-e,a[1]=g-d,a[3]=f-j,a[4]=c,a[5]=e);this.t.reset()}else this.i.p(b);this.j=b.layerX;this.k=b.layerY},v:function(){this.n=!0},u:function(){this.n=k},w:function(b){var a=b.wheelDeltaY?-b.wheelDeltaY/40:b.deltaY,a=Math.pow(0.996,void 0===a?0:a);s(this,a,a,(1-a)*this.j,(1-a)*this.k);b.preventDefault();return k},s:function(b){var a=this.a,c,e,d;for(e=a.length-1;1<=e;e--)if(c=a[e],r(b.layerX,b.layerY, c)){a.splice(e,1);return}c=a[0];e=(0.45+0.2*Math.random())*Math.sqrt(c[0]*c[0]+c[1]*c[1]);d=Math.random()*Math.PI;c=e*Math.cos(d);e*=Math.sin(d);c=[c,e,-e,c,b.layerX-(c+e)/2,b.layerY-(c-e)/2];a.push(c)},step:function(){var b=this.b,a,c,e,d;b.clearRect(0,0,this.width,this.height);if(this.n)for(var j=0;2>j;j++){0==j?(b.strokeStyle="black",b.lineWidth=4):(b.strokeStyle="yellow",b.lineWidth=2);for(var g=0;g<this.a.length;g++){1==j&&1==g&&(b.strokeStyle="white");a=this.a[g];b.beginPath();b.moveTo(a[4], a[5]);b.lineTo(a[4]+a[0],a[5]+a[2]);b.lineTo(a[4]+a[0]+a[1],a[5]+a[2]+a[3]);b.lineTo(a[4]+a[1],a[5]+a[3]);b.closePath();b.stroke();for(var f=0;2>f;f++)c=a[4]+a[0+f]/2,e=a[5]+a[2+f]/2,d=Math.sqrt(a[0+f]*a[0+f]+a[2+f]*a[2+f]),d=10<d?5/d:0.5,b.beginPath(),b.moveTo(c-(a[0+f]-a[2+f])*d,e-(a[2+f]+a[0+f])*d),b.lineTo(c,e),b.lineTo(c-(a[0+f]+a[2+f])*d,e-(a[2+f]-a[0+f])*d),b.stroke()}}}}; function r(b,a,c){return m(b,a,c[4],c[5],c[4]+c[0],c[5]+c[2],c[4]+c[1],c[5]+c[3])||m(b,a,c[4]+c[0]+c[1],c[5]+c[2]+c[3],c[4]+c[0],c[5]+c[2],c[4]+c[1],c[5]+c[3])}function s(b,a,c,e,d){b.i.transform(a,0,0,c,e,d);b.a.forEach(function(b){a2=b[0];b2=b[1];e2=b[4];c2=b[2];d2=b[3];f2=b[5];b[0]=a*a2+0*c2;b[1]=a*b2+0*d2;b[2]=0*a2+c*c2;b[3]=0*b2+c*d2;b[4]=e+a*e2+0*f2;b[5]=d+0*e2+c*f2})};function t(){u.step();v.step();requestAnimationFrame(t)}var w=document.querySelector("#fractal"),x=document.querySelector("#controls"),y=document.querySelector("#draw-target"),z=document.querySelector("#wrapper"),A=document.querySelector("#bg");w.width=x.width=y.width=z.offsetWidth;A.style.width=z.offsetWidth+"px";w.height=x.height=y.height=z.offsetHeight;A.style.height=z.offsetHeight+"px";x.addEventListener("contextmenu",function(b){b.preventDefault()},k); var B=[],C=y.width,D=y.height,E=Math.min(C/3,D/3),F,G,H,I,J;B.length=0;B.push([E,0,0,E,(C-E)/2,(D-E)/2]);for(var E=0.6*E,K=0;3>K;K++)F=2*Math.random()*Math.PI,G=E*Math.cos(F),H=-E*Math.sin(F),I=0.5<Math.random()?C*(1+Math.random())/5:C*(4-Math.random())/5,J=0.5<Math.random()?D*(1+Math.random())/5:D*(4-Math.random())/5,B.push([G,H,-H,G,I-G-H,J+H-G]),E*=0.8-0.1*Math.random();var u=new n(w,y,B),L=new p(y),v=new q(x,B,u,L);u.reset();t(); document.querySelector("#info a").onclick=function(){this.parentNode.style.display="none"};document.onclick=function(){document.body.className=""};document.B=function(){document.className="hover";return k};document.A=function(){document.className="";return k}; document.C=function(b){document.className="";b.preventDefault();b=b.dataTransfer.files[0];var a=new FileReader;a.onload=function(a){if("data:image/"==a.target.result.substr(0,11)){var b=new Image;b.onload=function(){var a=L.b,c,g,f,h;a.globalCompositeOperation="source-over";a.clearRect(0,0,L.width,L.height);b.width>L.width||b.height>L.height?L.height*b.width>b.height*L.width?(f=L.width,h=b.height*L.width/b.width,c=0,g=(L.height-h)/2):(f=b.width*L.height/b.height,h=L.height,c=(L.width-f)/2,g=0):(f= b.width,h=b.height,c=(L.width-b.width)/2,g=(L.height-b.height)/2);a.drawImage(b,c,g,f,h);f=a.getImageData(c,g,f,h);h=f.data;for(var l=0,M=h.length;l<M;l+=4){var N=h[l+3];h[l+3]=0|Math.max(h[l],h[l+1],h[l+2])*N/255;h[l]=h[l+1]=h[l+2]=255}a.putImageData(f,c,g)};b.src=a.target.result}};a.readAsDataURL(b);return k};
